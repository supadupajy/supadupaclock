<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workday Wave Clock - Beach Edition (Fixed)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;900&family=JetBrains+Mono:wght@600&display=swap" rel="stylesheet">

    <style>
        :root { 
            --bg-color: #eed6af; 
            --wave-color: #5a9bd5; 
            --text-color: #5d4a37; 
            --neon-color: #ffeb3b; 
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-color); 
            background-image: 
                radial-gradient(circle at 2px 2px, rgba(0,0,0,0.04) 1px, transparent 0),
                radial-gradient(circle at 5px 10px, rgba(255,255,255,0.2) 1px, transparent 0);
            background-size: 4px 4px, 11px 11px;
            height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center; overflow: hidden; 
        }

        /* --- ìƒë‹¨ íƒ€ì„ë¼ì¸ & ìº˜ë¦°ë” ë§‰ëŒ€ --- */
        .timeline-container { position: fixed; top: 0; left: 0; width: 100vw; height: 50px; padding: 0 25px; z-index: 20; pointer-events: none; }
        .timeline-inner { position: relative; width: 100%; height: 100%; }
        #minute-marker {
            position: absolute; top: 0; width: 0; height: 0;
            border-left: 8px solid transparent; border-right: 8px solid transparent;
            border-top: 12px solid #ffffff; transform: translateX(-50%);
            z-index: 25; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3)); transition: left 0.5s ease-out;
        }
        .time-mark { position: absolute; top: 15px; transform: translateX(-50%); font-family: 'Inter', sans-serif; font-size: 0.75rem; font-weight: 700; color: var(--text-color); opacity: 0.5; white-space: nowrap; transition: all 0.3s ease; }
        .time-mark.active { opacity: 1; font-weight: 900; color: #000; transform: translateX(-50%) scale(1.1); text-shadow: -1.5px -1.5px 0 #fff, 1.5px -1.5px 0 #fff, -1.5px 1.5px 0 #fff, 1.5px 1.5px 0 #fff; }

        .event-bar { position: absolute; bottom: 5px; height: 6px; background: #33ff33; border-radius: 3px; z-index: 15; box-shadow: 0 0 8px rgba(255, 112, 67, 0.5); }

        /* --- ë°°ê²½ & íŒŒë„ & ì•„ì´ì½˜ --- */
        .background-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        #wave-wrapper { position: absolute; top: 0; left: 0; height: 100%; width: 0%; background-color: var(--wave-color); transition: width 1s linear; box-shadow: 5px 0 15px rgba(0,0,0,0.1); }
        .wave-layer { position: absolute; top: 0; width: 120px; height: 100%; background-repeat: repeat-y; background-size: 100% 600px; }
        .layer-1 { background-color: var(--wave-color); animation: waveSwing 3s ease-in-out infinite; z-index: 3; right: -30px; border-right: 4px solid rgba(255,255,255,0.3); }
        .layer-2 { background-color: var(--wave-color); animation: waveSwing 4.5s ease-in-out infinite reverse; z-index: 2; opacity: 0.5; right: -35px; }
        .layer-3 { background-color: var(--wave-color); animation: waveSwing 2s ease-in-out infinite; z-index: 1; opacity: 0.2; right: -40px; }
        @keyframes waveSwing { 0%, 100% { transform: translateX(0px); } 50% { transform: translateX(-25px); } }

        #beach-items-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -2; }
        .beach-item { position: absolute; font-size: 2rem; filter: drop-shadow(2px 4px 3px rgba(0,0,0,0.15)); display: inline-block; }

        /* --- ì‹œê³„ ìœ„ì ¯ --- */
        .clock-container { 
            width: 600px; height: 300px; text-align: center; background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(15px); 
            border-radius: 40px; z-index: 10; border: 2px solid rgba(255, 255, 255, 0.4); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.08); transition: all 0.3s ease;
        }
        @keyframes alarm-flash { 0%, 100% { border-color: rgba(255, 255, 255, 0.5); } 50% { border-color: #ff4d4d; box-shadow: 0 0 30px rgba(255, 77, 77, 0.4); } }
        .clock-container.upcoming-alert { animation: alarm-flash 0.8s infinite; border-width: 4px; }

        .time-wrapper { display: flex; align-items: baseline; justify-content: center; gap: 10px; }
        #clock { font-family: 'Inter', sans-serif; font-size: 6rem; font-weight: 900; letter-spacing: -2px; line-height: 1; color: var(--text-color); font-variant-numeric: tabular-nums; }
        #ampm { font-family: 'Inter', sans-serif; font-weight: 900; font-size: 3rem; color: var(--text-color); opacity: 0.8; }
        #status-text { margin-top: 15px; font-size: 0.95rem; font-weight: 700; color: #4479a8; max-width: 80%; }
        
        #auth-btn { margin-top: 15px; padding: 10px 24px; border: none; border-radius: 15px; background: var(--wave-color); color: white; font-weight: 800; cursor: pointer; transition: all 0.3s ease; }

        /* --- ë‚ ì”¨ & ë¯¸ì„¸ë¨¼ì§€ ìœ„ì ¯ --- */
        .info-widget { position: fixed; background: rgba(255, 255, 255, 0.3); backdrop-filter: blur(15px); border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.4); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; width: 120px; height: 120px; top: 50%; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .widget-icon { font-size: 3rem; margin-bottom: 5px; }
        .widget-label { font-weight: 800; font-size: 1rem; color: var(--text-color); }
        #weather-widget { left: calc(25vw - 150px); transform: translate(-50%, -50%); }
        #dust-widget { right: calc(25vw - 150px); transform: translate(50%, -50%); }

        .click-ripple { position: fixed; width: 20px; height: 20px; background: rgba(255, 255, 255, 0.5); border: 2px solid #ffffff; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; animation: rippleAnim 0.6s ease-out forwards; z-index: 99; }
        @keyframes rippleAnim { to { width: 150px; height: 150px; opacity: 0; } }
    </style>
</head>
<body>
    <div class="timeline-container">
        <div id="timeline" class="timeline-inner"><div id="minute-marker"></div></div>
    </div>

    <div id="weather-widget" class="info-widget">
        <div id="weather-icon" class="widget-icon">â˜€ï¸</div>
        <div id="weather-temp" class="widget-label">--Â°C</div>
    </div>

    <div id="dust-widget" class="info-widget">
        <div id="dust-icon" class="widget-icon">â“</div>
        <div id="dust-status" class="widget-label">ì—°ê²°ì¤‘</div>
    </div>

    <div id="beach-items-layer"></div>

    <div class="background-container">
        <div id="wave-wrapper">
            <div class="wave-layer layer-1"></div>
            <div class="wave-layer layer-2"></div>
            <div class="wave-layer layer-3"></div>
        </div>
    </div>
    
    <div class="clock-container" id="clock-widget">
        <div class="time-wrapper">
            <span id="ampm">AM</span>
            <div id="clock">
                <span id="hour-text">00</span><span id="colon">:</span><span id="min-text">00</span>
            </div>
        </div>
        <div id="status-text">ë°”ë‹¤ ìœ„ ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</div>
        <button id="auth-btn" style="display:none;" onclick="handleAuthClick()">Google Login</button>
    </div>

    <script>
        const CLIENT_ID = '759508147373-jbd92l1p7ta1c4rqh7sel94ce0i843l8.apps.googleusercontent.com';
        const START_HOUR = 10;
        const END_HOUR = 19;
        let tokenClient;
        let cachedEvents = [];

        function spawnBeachItems() {
            const layer = document.getElementById('beach-items-layer');
            const icons = ['ğŸ¦€', 'ğŸš', 'â­', 'ğŸª¨', 'ğŸŒ¿', 'ğŸš', 'ğŸš', 'ğŸª¨'];
            for (let i = 0; i < 12; i++) {
                const item = document.createElement('span');
                item.className = 'beach-item';
                item.innerText = icons[Math.floor(Math.random() * icons.length)];
                item.style.left = `${Math.random() * 94 + 3}%`;
                item.style.top = `${Math.random() * 80 + 10}%`;
                const scale = 0.6 + Math.random() * 1;
                item.style.transform = `scale(${scale}) rotate(${Math.random() * 360}deg)`;
                layer.appendChild(item);
            }
        }

        // [ë³µêµ¬ ì™„ë£Œ] ë‚ ì”¨ ë° ë¯¸ì„¸ë¨¼ì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateWeather() {
            navigator.geolocation.getCurrentPosition(async (pos) => {
                const { latitude: lat, longitude: lon } = pos.coords;
                
                // 1. ë‚ ì”¨ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                try {
                    const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                    const wData = await wRes.json();
                    document.getElementById('weather-temp').innerText = `${Math.round(wData.current_weather.temperature)}Â°C`;
                    const icons = { 0: 'â˜€ï¸', 1: 'â›…', 2: 'â›…', 3: 'â˜ï¸', 45: 'ğŸŒ«ï¸', 51: 'ğŸŒ§ï¸', 61: 'ğŸŒ§ï¸', 71: 'â„ï¸', 95: 'âš¡' };
                    document.getElementById('weather-icon').innerText = icons[wData.current_weather.weathercode] || 'â›…';
                } catch (e) { console.error("ë‚ ì”¨ ë¡œë“œ ì‹¤íŒ¨"); }

                // 2. ë¯¸ì„¸ë¨¼ì§€(AQI) ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                try {
                    const dRes = await fetch(`https://api.waqi.info/feed/here/?token=demo`);
                    const dData = await dRes.json();
                    if(dData.status === "ok") {
                        const aqi = dData.data.aqi;
                        let status, icon;
                        if (aqi <= 50) { status = "ì¢‹ìŒ"; icon = "ğŸ˜Š"; }
                        else if (aqi <= 100) { status = "ë³´í†µ"; icon = "ğŸ™‚"; }
                        else if (aqi <= 150) { status = "ë‚˜ì¨"; icon = "ğŸ˜«"; }
                        else { status = "ë§¤ìš°ë‚˜ì¨"; icon = "â˜ ï¸"; }
                        
                        document.getElementById('dust-status').innerText = status;
                        document.getElementById('dust-icon').innerText = icon;
                    }
                } catch (e) { 
                    console.error("ë¯¸ì„¸ë¨¼ì§€ ë¡œë“œ ì‹¤íŒ¨");
                    document.getElementById('dust-status').innerText = "ì˜¤ë¥˜";
                }
            });
        }

        // ìº˜ë¦°ë” ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
        function gapiLoaded() { gapi.load('client', async () => { await gapi.client.init({ discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'] }); checkInit(); }); }
        function gisLoaded() { tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.events.readonly', callback: '', }); checkInit(); }
        function checkInit() { if (typeof gapi !== 'undefined' && tokenClient) { const storedToken = localStorage.getItem('gapi_token'); if (storedToken) { const token = JSON.parse(storedToken); gapi.client.setToken(token); document.getElementById('auth-btn').style.display = "none"; listUpcomingEvents(); } else { document.getElementById('auth-btn').style.display = "block"; document.getElementById('status-text').innerText = "êµ¬ê¸€ ë¡œê·¸ì¸ìœ¼ë¡œ ì¼ì •ì„ ì—°ë™í•´ ë³´ì„¸ìš” ğŸ—“ï¸"; } } }
        function handleAuthClick() { tokenClient.callback = async (resp) => { if (resp.error !== undefined) throw (resp); localStorage.setItem('gapi_token', JSON.stringify(resp)); document.getElementById('auth-btn').style.display = "none"; await listUpcomingEvents(); }; tokenClient.requestAccessToken({prompt: 'select_account'}); }
        
        async function listUpcomingEvents() {
            try {
                const token = gapi.client.getToken(); if (!token) return;
                const now = new Date();
                const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString();
                const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59).toISOString();
                const response = await gapi.client.calendar.events.list({ 'calendarId': 'primary', 'timeMin': startOfDay, 'timeMax': endOfDay, 'showDeleted': false, 'singleEvents': true, 'orderBy': 'startTime' });
                cachedEvents = response.result.items;
                renderEventBars(cachedEvents);
                const upcoming = cachedEvents.find(e => new Date(e.start.dateTime || e.start.date) > now);
                const statusText = document.getElementById('status-text');
                if (upcoming) {
                    const startDate = new Date(upcoming.start.dateTime || upcoming.start.date);
                    const timeStr = upcoming.start.dateTime ? startDate.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : "í•˜ë£¨ ì¢…ì¼";
                    statusText.innerText = `ë‹¤ìŒ ì¼ì •: [${timeStr}] ${upcoming.summary} ğŸ—“ï¸`;
                } else {
                    statusText.innerText = cachedEvents.length > 0 ? "ì˜¤ëŠ˜ì˜ ëª¨ë“  íŒŒë„ë¥¼ ë„˜ì—ˆìŠµë‹ˆë‹¤ âœ¨" : "ì˜¤ëŠ˜ì€ ì¼ì •ì´ ì—†ë„¤ìš”! ğŸ–ï¸";
                }
            } catch (err) { if (err.status === 401) refreshAccessToken(); }
        }

        function renderEventBars(events) {
            const timeline = document.getElementById('timeline');
            document.querySelectorAll('.event-bar').forEach(b => b.remove());
            events.forEach(event => {
                if (!event.start.dateTime) return;
                const start = new Date(event.start.dateTime), end = new Date(event.end.dateTime);
                const sH = start.getHours() + (start.getMinutes() / 60), eH = end.getHours() + (end.getMinutes() / 60);
                if (eH < START_HOUR || sH > END_HOUR) return;
                const left = ((Math.max(sH, START_HOUR) - START_HOUR) / (END_HOUR - START_HOUR)) * 100;
                const width = ((Math.min(eH, END_HOUR) - Math.max(sH, START_HOUR)) / (END_HOUR - START_HOUR)) * 100;
                const bar = document.createElement('div');
                bar.className = 'event-bar';
                bar.style.left = `${left}%`; bar.style.width = `${width}%`;
                timeline.appendChild(bar);
            });
        }

        function updateClock() {
            const now = new Date();
            const h = now.getHours(), m = now.getMinutes(), s = now.getSeconds(), ms = now.getMilliseconds();
            document.getElementById('hour-text').innerText = String(h % 12 || 12).padStart(2, '0');
            document.getElementById('min-text').innerText = String(m).padStart(2, '0');
            document.getElementById('ampm').innerText = h >= 12 ? 'PM' : 'AM';
            document.getElementById('colon').style.visibility = (ms < 500) ? 'visible' : 'hidden';

            const currentSec = (h * 3600) + (m * 60) + s;
            const progress = Math.min(Math.max((currentSec - (START_HOUR * 3600)) / ((END_HOUR - START_HOUR) * 3600), 0), 1);
            document.getElementById('wave-wrapper').style.width = `${progress * 100}%`;
            document.getElementById('minute-marker').style.left = `${progress * 100}%`;
            
            // 5ë¶„ ì „ ì•ŒëŒ ì²´í¬
            const clockWidget = document.getElementById('clock-widget');
            let isAlert = false;
            cachedEvents.forEach(e => {
                if (e.start.dateTime) {
                    const diff = (new Date(e.start.dateTime).getTime() - now.getTime()) / 60000;
                    if (diff > 0 && diff <= 5) isAlert = true;
                }
            });
            if (isAlert) clockWidget.classList.add('upcoming-alert');
            else clockWidget.classList.remove('upcoming-alert');
        }

        function createTimeline() {
            const timeline = document.getElementById('timeline');
            for (let i = 0; i <= (END_HOUR - START_HOUR); i++) {
                const h = START_HOUR + i;
                const mark = document.createElement('div');
                mark.className = 'time-mark';
                mark.style.left = `${(i / (END_HOUR - START_HOUR)) * 100}%`;
                mark.innerText = h < 12 ? `${h}am` : (h === 12 ? `12pm` : `${h - 12}pm`);
                timeline.appendChild(mark);
            }
        }

        window.addEventListener('mousedown', (e) => {
            const ripple = document.createElement('div');
            ripple.className = 'click-ripple';
            document.body.appendChild(ripple);
            ripple.style.left = `${e.clientX}px`; ripple.style.top = `${e.clientY}px`;
            ripple.addEventListener('animationend', () => ripple.remove());
        });

        spawnBeachItems(); createTimeline(); updateClock(); updateWeather();
        setInterval(updateClock, 100); setInterval(updateWeather, 600000); setInterval(listUpcomingEvents, 300000);
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>